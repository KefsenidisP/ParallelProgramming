I wrote a synchronized statement in C to implement this
